---
title: "Análisis de Redes - Tesis de Jurisprudencia"
output: html_document
date: '2022-08-16'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#echo = FALSE, 
```

## Análisis de Redes - Tesis de Jurisprudencia

Comenzamos cargando librerías y los datos correspondientes:

```{r}
library(tidyverse)
library(tidygraph)
library(ggraph)
library(igraphdata)
total <- read.csv("../output/tesis_secr_expand_rep.csv")
socio <- read.csv("../data/sociodemo/X1_Sociodemograficos_1_sinduplicados.csv")
dim(total)
dim(socio)
```

Contamos nombres únicos:

```{r}
count(distinct(total, ponente))
count(distinct(total, secretario))
```

Hacemos relación de nombres con IDs:

```{r}
set.seed(2022)

# Primero limpiamos nombres:
total_1 <- total %>% select(id_tesis, X._reiteracion, instancia, epoca, materia, fecha, ponente, 
                              S1, S2, S3, S4, S5, S6, ponente_rep) %>%
  mutate(id_tesis = as.character(id_tesis)) %>%
  
  mutate(ponente_clean = str_to_lower(ponente)) %>%
  mutate(ponente_clean = str_replace_all(ponente_clean, " ", "")) %>%
  mutate(ponente_clean = str_replace_all(ponente_clean, "[[:punct:]]", "")) %>%
  mutate(ponente_clean = chartr('áéíóú','aeiou', ponente_clean)) %>%
  
  mutate(S1_clean = str_to_lower(S1))  %>%
  mutate(S1_clean = str_replace_all(S1_clean, " ", "")) %>%
  mutate(S1_clean = str_replace_all(S1_clean, "[[:punct:]]", "")) %>%
  mutate(S1_clean = chartr('áéíóú','aeiou', S1_clean)) %>% 
  
  mutate(S2_clean = str_to_lower(S2))  %>%
  mutate(S2_clean = str_replace_all(S2_clean, " ", "")) %>%
  mutate(S2_clean = str_replace_all(S2_clean, "[[:punct:]]", "")) %>%
  mutate(S2_clean = chartr('áéíóú','aeiou', S2_clean)) %>% 
  
  mutate(S3_clean = str_to_lower(S3))  %>%
  mutate(S3_clean = str_replace_all(S3_clean, " ", "")) %>%
  mutate(S3_clean = str_replace_all(S3_clean, "[[:punct:]]", "")) %>%
  mutate(S3_clean = chartr('áéíóú','aeiou', S3_clean)) %>% 
  
  mutate(S4_clean = str_to_lower(S4))  %>%
  mutate(S4_clean = str_replace_all(S4_clean, " ", "")) %>%
  mutate(S4_clean = str_replace_all(S4_clean, "[[:punct:]]", "")) %>%
  mutate(S4_clean = chartr('áéíóú','aeiou', S4_clean)) %>% 
  
  mutate(S5_clean = str_to_lower(S5))  %>%
  mutate(S5_clean = str_replace_all(S5_clean, " ", "")) %>%
  mutate(S5_clean = str_replace_all(S5_clean, "[[:punct:]]", "")) %>%
  mutate(S5_clean = chartr('áéíóú','aeiou', S5_clean)) %>% 
  
  mutate(S6_clean = str_to_lower(S6))  %>%
  mutate(S6_clean = str_replace_all(S6_clean, " ", "")) %>%
  mutate(S6_clean = str_replace_all(S6_clean, "[[:punct:]]", "")) %>%
  mutate(S6_clean = chartr('áéíóú','aeiou', S6_clean)) 

# Agregamos identificadores únicos para ponentes:
total_1$id_ponente <- total_1 %>% group_indices(ponente_clean)
total_1 <- transform(total_1, id_ponente = as.character(id_ponente))

# Creamos dataframe con nombres únicos de ponentes:
ponentes <- total_1 %>%
  select(ponente, ponente_clean, id_ponente)
ponentes <- ponentes[!duplicated(ponentes$id_ponente), ]
colnames(ponentes)[colnames(ponentes) == "id_ponente"] <- "id"
ponentes <- transform(ponentes, id = as.character(id))

# Creamos dataframe para nombres únicos de secretarios:
secretarios <- setNames(data.frame(c(total_1$S1, total_1$S2, total_1$S3, 
                                      total_1$S4, total_1$S5, total_1$S6)), "secretario")
secretarios$secretario_clean <- c(total_1$S1_clean, total_1$S2_clean, total_1$S3_clean, 
                                   total_1$S4_clean, total_1$S5_clean, total_1$S6_clean)
secretarios <- secretarios[!duplicated(secretarios$secretario_clean), ]
secretarios$id <- seq.int(nrow(secretarios)) 
secretarios <- transform(secretarios, id = as.character(id))

# Seleccionamos columnas de datos sociodemográficos:
socio_1 <- socio %>% 
  select(id = id_final, name, nombres_clean)
```

Definimos funciones:

```{r}
calcular_tejas <- function(x, k = 4, lowercase = FALSE){
  tokenizers::tokenize_character_shingles(x, n = k, lowercase = lowercase,
    simplify = TRUE, strip_non_alpha = FALSE)
}

generar_hash <- function(){
  r <- as.integer(stats::runif(1, 1, 2147483647))
  funcion_hash <- function(tejas){
        digest::digest2int(tejas, seed = r) 
  }
  funcion_hash
}

construir_firmas <- function(hashes, tejas){
  tibble(hash_num = 1:length(hashes), 
         firma = map_int(hashes, \(h) min(h(tejas)))
  )
}

sim_jaccard <- \(a, b)  length(intersect(a, b)) / length(union(a, b))
```

Hacemos tejas para cada lista:

```{r}
# Tejas para nombres de ponentes:
ponente_tejas <- ponentes %>% 
  mutate(tejas = map(ponente_clean, ~ calcular_tejas(.x, k = 5)))

# Tejas para nombres de secretarios:
secretario_tejas <- secretarios %>% 
  mutate(tejas = map(secretario_clean, ~ calcular_tejas(.x, k = 5)))

# Tejas de datos sociodemográficos:
socio_tejas <- socio_1 %>% 
  mutate(tejas = map(nombres_clean, ~ calcular_tejas(.x, k = 5)))
```

Calculamos minhashes:

```{r}
# Crearemos 2 hashes por nombre:
hashes <- map(1:2, ~ generar_hash())

# Minhashes de ponentes:
ponente_firmas <- ponente_tejas %>% 
  mutate(firma = map(tejas, ~ construir_firmas(hashes, .x))) %>%
  select(id, firma) %>%
  unnest(firma) %>%
  mutate(cubeta = paste(hash_num, firma, sep = "-")) %>%
  select(id, cubeta)

# Minhashes de secretarios:
secretario_firmas <- secretario_tejas %>% 
  mutate(firma = map(tejas, ~ construir_firmas(hashes, .x))) %>%
  select(id, firma) %>%
  unnest(firma) %>%
  mutate(cubeta = paste(hash_num, firma, sep = "-")) %>%
  select(id, cubeta)

# Minhashes de datos sociodemográficos:
socio_firmas <- socio_tejas %>%
  mutate(firma = map(tejas, ~ construir_firmas(hashes, .x))) %>%
  select(id, firma) %>%
  unnest(firma) %>%
  mutate(cubeta = paste(hash_num, firma, sep = "-")) %>%
  select(id, cubeta)
```

Hacemos una unión por cubetas para obtener nuestros pares candidatos:

```{r}
# Candidatos de ponentes:
ponente_candidatos_tbl <- inner_join(socio_firmas %>% rename(id_socio = id), 
                                     ponente_firmas %>% rename(id_ponente = id))

# Candidatos de secretarios:
secretario_candidatos_tbl <- inner_join(socio_firmas %>% rename(id_socio = id), 
                                     secretario_firmas %>% rename(id_secretario = id))
```

Calculamos similitud exacta para candidatos

```{r}
# Similitud para ponentes:
ponente_candidatos_score_tbl <- ponente_candidatos_tbl %>%
  left_join(socio_tejas %>%
              select(id_socio = id, tejas_socio = tejas)) %>%
  left_join(ponente_tejas %>%
              select(id_ponente = id, tejas_ponente = tejas)) %>%
  mutate(score = map2_dbl(tejas_socio, tejas_ponente, ~ sim_jaccard(.x, .y))) %>%
  select(-tejas_socio, -tejas_ponente, -cubeta)

ponente_candidatos_score_tbl <- ponente_candidatos_score_tbl %>%
  unique()

ponente_candidatos_score_tbl
```

```{r}
# Similitud para secretarios:
secretario_candidatos_score_tbl <- secretario_candidatos_tbl %>%
  left_join(socio_tejas %>%
              select(id_socio = id, tejas_socio = tejas)) %>%
  left_join(secretario_tejas %>%
              select(id_secretario = id, tejas_secretario = tejas)) %>%
  mutate(score = map2_dbl(tejas_socio, tejas_secretario, ~ sim_jaccard(.x, .y))) %>%
  select(-tejas_socio, -tejas_secretario, -cubeta)

secretario_candidatos_score_tbl <- secretario_candidatos_score_tbl %>%
  unique()

secretario_candidatos_score_tbl
```

Proponemos puntos de corte:

```{r}
# Punto de corte para ponentes:
ponente_candidatos_filt <- filter(ponente_candidatos_score_tbl, score > 0.6) %>%
  left_join(socio_1 %>%
              select(id_socio = id, name)) %>%
  left_join(ponentes %>%
              select(id_ponente = id, ponente)) %>%
  arrange(-score)

tail(ponente_candidatos_filt)
nrow(ponentes)
nrow(ponente_candidatos_filt)
```

```{r}
# Punto de corte para secretarios:
secretario_candidatos_filt <- filter(secretario_candidatos_score_tbl, score > 0.55) %>%
  left_join(socio_1 %>%
              select(id_socio = id, name)) %>%
  left_join(secretarios %>%
              select(id_secretario = id, secretario)) %>%
  arrange(-score)

tail(secretario_candidatos_filt)
nrow(secretarios)
nrow(secretario_candidatos_filt)
```

Si queremos examinar candidatos específicos:

```{r}
# Candidatos con score de 1:

# Nombre en lista de datos sociodemográficos:
socio_1 %>% filter_at(vars(id), any_vars(. %in% c('AAJ_3982')))

# Nombre de ponente:
ponentes %>% filter_at(vars(id), any_vars(. %in% c('766')))
```

Agregamos el ID sociodemográfico a los datos y eliminamos registros nulos:

```{r}
# Creamos dataframe con ID sociodemográfico y nombres limpios para secretarios:
secretarios_id <- secretarios %>%
  left_join(secretario_candidatos_filt) %>%
  select(-id_secretario, -score, -name)

# Agregamos ID sociodemográfico a ponentes:
total_id <- total_1 %>% 
  left_join(ponente_candidatos_filt) %>%
  rename(id_ponente_socio = id_socio) %>%
  select(-score, -name) %>%
  unique()

# Agregamos ID sociodemográfico a secretarios:
total_id <- total_id %>%
  #S1:
  rename(secretario_clean = S1_clean) %>%
  left_join(secretarios_id) %>%
  select(-secretario, -id) %>%
  rename(S1_clean = secretario_clean, id_S1_socio = id_socio) %>%
  unique() %>%
  #S2:
  rename(secretario_clean = S2_clean) %>%
  left_join(secretarios_id) %>%
  select(-secretario, -id) %>%
  rename(S2_clean = secretario_clean, id_S2_socio = id_socio) %>%
  unique() %>%
  #S3:
  rename(secretario_clean = S3_clean) %>%
  left_join(secretarios_id) %>%
  select(-secretario, -id) %>%
  rename(S3_clean = secretario_clean, id_S3_socio = id_socio) %>%  
  unique() %>%
  #S4:
  rename(secretario_clean = S4_clean) %>%
  left_join(secretarios_id) %>%
  select(-secretario, -id) %>%
  rename(S4_clean = secretario_clean, id_S4_socio = id_socio) %>% 
  unique() %>%
  #S5:
  rename(secretario_clean = S5_clean) %>%
  left_join(secretarios_id) %>%
  select(-secretario, -id) %>%
  rename(S5_clean = secretario_clean, id_S5_socio = id_socio) %>% 
  unique() %>%
  #S6:
  rename(secretario_clean = S6_clean) %>%
  left_join(secretarios_id) %>%
  select(-secretario, -id) %>%
  rename(S6_clean = secretario_clean, id_S6_socio = id_socio) %>%
  unique()

total_id <- total_id %>%
  unique()

# Agregamos identificador de repetición a ponentes:
total_id <- total_id %>%
  mutate(id_ponente_socio_rep = case_when(grepl(".*_REP", ponente_rep) & 
                                      id_ponente_socio != is.na(id_ponente_socio) 
                                      ~ paste0(id_ponente_socio, "_REP"),
                                    TRUE ~ id_ponente_socio))

# Eliminamos registros sin ponente:
total_id_nona <- total_id %>% 
  drop_na(ponente) %>%
  arrange(id_tesis, X._reiteracion)
```

Comparamos número de tesis totales contra las tesis de las que tenemos datos de ponentes/secretarios:

```{r}
# Número de tesis totales:
length(unique(total_id$id_tesis))

# Número de tesis de las que tenemos datos de ponentes/secretarios:
length(unique(total_id_nona$id_tesis))
```

Si eliminamos reiteraciones a sí mismos:

```{r}
unico <- total %>% select(id_tesis, ponente, secretario)
unico <- unico %>% distinct(id_tesis, ponente, .keep_all = TRUE)
unico <- unico %>% distinct(id_tesis, secretario, .keep_all = TRUE)

dim(unico)
```

```{r}
# Tesis con más de 5 reiteraciones
total %>% 
  group_by(id_tesis,epoca) %>%
  summarise(n_reiter = n()) %>%
  filter(n_reiter > 5) %>% 
  filter(epoca != "Novena Época") %>% 
  arrange(epoca)
```

**Red Ponentes-Secretarios**

```{r}
# Creamos df con info necesaria:
pon_sec_df <- total_id_nona %>% 
  pivot_longer(cols = names(total_id_nona)[24:29],
                    values_to = "id_secretario_socio") %>% 
  select(id_tesis,X._reiteracion,instancia,epoca,materia,id_ponente_socio,id_ponente_socio_rep,id_secretario_socio) %>% 
  drop_na(id_secretario_socio) %>% 
  drop_na(id_ponente_socio_rep) 

pon_sec_df <- pon_sec_df[!duplicated(pon_sec_df), ]

# Agregamos datos sociodemográficos a ponentes
pon_sec_df$genero_pon <- socio[match(pon_sec_df$id_ponente_socio,socio$id_final),"gender"]
pon_sec_df$anio_pon <- socio[match(pon_sec_df$id_ponente_socio,socio$id_final),"year_of_birth"]
pon_sec_df$edo_pon <- socio[match(pon_sec_df$id_ponente_socio,socio$id_final),"state_of_birth"]
pon_sec_df$escuela_pon <- socio[match(pon_sec_df$id_ponente_socio,socio$id_final),"college"]

# Agregamos datos sociodemográficos a secretarios
pon_sec_df$genero_sec <- socio[match(pon_sec_df$id_secretario_socio,socio$id_final),"gender"]
pon_sec_df$anio_sec <- socio[match(pon_sec_df$id_secretario_socio,socio$id_final),"year_of_birth"]
pon_sec_df$edo_sec <- socio[match(pon_sec_df$id_secretario_socio,socio$id_final),"state_of_birth"]
pon_sec_df$escuela_sec <- socio[match(pon_sec_df$id_secretario_socio,socio$id_final),"college"]

# Agregamos columna con generaciones:
pon_sec_df <- pon_sec_df %>%
  mutate(gen_pon = case_when(anio_pon >= 1912 & anio_pon <= 1921 ~ "Depresion",
                             anio_pon >= 1922 & anio_pon <= 1927 ~ "Segunda GM",
                             anio_pon >= 1928 & anio_pon <= 1945 ~ "Post Guerra",
                             anio_pon >= 1946 & anio_pon <= 1954 ~ "Boomers I",
                             anio_pon >= 1955 & anio_pon <= 1965 ~ "Boomers II",
                             anio_pon >= 1966 & anio_pon <= 1976 ~ "Generacion X",
                             TRUE ~ "Previos")) %>% 
  relocate(gen_pon, .before = edo_pon)

pon_sec_df <- pon_sec_df %>%
  mutate(gen_sec = case_when(anio_sec >= 1912 & anio_sec <= 1921 ~ "Depresion",
                             anio_sec >= 1922 & anio_sec <= 1927 ~ "Segunda GM",
                             anio_sec >= 1928 & anio_sec <= 1945 ~ "Post Guerra",
                             anio_sec >= 1946 & anio_sec <= 1954 ~ "Boomers I",
                             anio_sec >= 1955 & anio_sec <= 1965 ~ "Boomers II",
                             anio_sec >= 1966 & anio_sec <= 1976 ~ "Generacion X",
                             TRUE ~ "Previos")) %>% 
  relocate(gen_sec, .before = edo_sec)

# Creamos nodos
nodes_pon_sec <- data.frame(
  data.frame(label=unlist(pon_sec_df[, c("id_ponente_socio_rep","id_secretario_socio")], use.names = FALSE)),
  data.frame(genero=unlist(pon_sec_df[, c("genero_pon","genero_sec")], use.names = FALSE)),
  data.frame(generacion=unlist(pon_sec_df[, c("gen_pon","gen_sec")], use.names = FALSE)),
  data.frame(edo=unlist(pon_sec_df[, c("edo_pon","edo_sec")], use.names = FALSE)),
  data.frame(escuela=unlist(pon_sec_df[, c("escuela_pon","escuela_sec")], use.names = FALSE)))

nodes_pon_sec <- nodes_pon_sec[!duplicated(nodes_pon_sec$label), ]
nodes_pon_sec$id <- nodes_pon_sec %>% group_indices(label) 
nodes_pon_sec <- nodes_pon_sec %>%
  relocate(id, .before = label)

# Creamos aristas
edges_pon_sec <- pon_sec_df %>% select(id_ponente_socio_rep,id_secretario_socio,instancia,epoca,materia)
edges_pon_sec$from <- nodes_pon_sec[match(edges_pon_sec$id_ponente_socio_rep,nodes_pon_sec$label),"id"]
edges_pon_sec$to <- nodes_pon_sec[match(edges_pon_sec$id_secretario_socio,nodes_pon_sec$label),"id"]

#edges_pon_sec <- edges_pon_sec %>% group_by(from,to) %>% 
#  summarise(n_reiter = n()) %>%
#  arrange(-n_reiter)
edges_pon_sec <- edges_pon_sec %>%
  select(from,to,instancia,epoca,materia)

# Creamos red:
red_pon_sec <- tbl_graph(nodes = nodes_pon_sec, 
                  edges = edges_pon_sec, 
                  directed = TRUE)

# Agregamos medidas de intermediación y centralidad
red_pon_sec <- red_pon_sec %>% 
  activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(),
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"),
         out_degree = centrality_degree(mode = "out"))

red_pon_sec
```

```{r}
red_pon_sec %>% 
    activate(nodes) %>% 
    as_tibble() %>% 
    arrange(desc(intermediacion))
```

**Red Ponentes-Ponentes, usando sólo tesis con ID sociodemográfico para TODOS sus ponentes**

```{r}
# Creamos df con info necesaria:
pon_pon_df <- total_id_nona %>%
  group_by(id_tesis) %>%
  filter(!any(id_ponente_socio_rep == "NA")) %>%
  select(id_tesis,X._reiteracion,instancia,epoca,materia,id_ponente_socio,id_ponente_socio_rep)

# Agregamos datos sociodemográficos a ponentes
pon_pon_df$genero <- socio[match(pon_pon_df$id_ponente_socio,socio$id_final),"gender"]
pon_pon_df$anio <- socio[match(pon_pon_df$id_ponente_socio,socio$id_final),"year_of_birth"]
pon_pon_df$edo <- socio[match(pon_pon_df$id_ponente_socio,socio$id_final),"state_of_birth"]
pon_pon_df$escuela <- socio[match(pon_pon_df$id_ponente_socio,socio$id_final),"college"]

# Agregamos columna con generaciones:
pon_pon_df <- pon_pon_df %>%
  mutate(generacion = case_when(anio >= 1912 & anio <= 1921 ~ "Depresion",
                                anio >= 1922 & anio <= 1927 ~ "Segunda GM",
                                anio >= 1928 & anio <= 1945 ~ "Post Guerra",
                                anio >= 1946 & anio <= 1954 ~ "Boomers I",
                                anio >= 1955 & anio <= 1965 ~ "Boomers II",
                                anio >= 1966 & anio <= 1976 ~ "Generacion X",
                                TRUE ~ "Previos")) %>% 
  relocate(generacion, .before = edo)

# Agregamos identificador único:
pon_pon_df$id <- pon_pon_df %>% group_indices(id_ponente_socio_rep)

# Creamos nodos:
nodes_pon_pon <- pon_pon_df[, c("id", "id_ponente_socio_rep", "genero", "generacion", "edo", "escuela")]
nodes_pon_pon <- nodes_pon_pon[!duplicated(nodes_pon_pon$id), ] %>%
  rename(label = id_ponente_socio_rep)

# Creamos aristas:
aux_df <- pon_pon_df %>% 
  group_by(id_tesis) %>% 
  slice(1) %>% 
  select(id_tesis,instancia,epoca,materia) %>% 
  ungroup()

comb_pon_pon <- pon_pon_df %>%
  group_by(id_tesis) %>%
  summarise(comb = t(combn(id, 2)))
comb_pon_pon <- data.frame(id_tesis=comb_pon_pon[1], from=comb_pon_pon$comb[,1], to=comb_pon_pon$comb[,2])

comb_pon_pon <- comb_pon_pon %>% 
  left_join(aux_df)

edges_pon_pon <- comb_pon_pon %>%
  select(from,to,instancia,epoca,materia)
#edges_pon_pon <- edges_pon_pon %>% group_by(from,to) %>% 
#  summarise(n_reiter = n()) %>%
#  arrange(-n_reiter)

# Creamos red:
red_pon_pon <- tbl_graph(nodes = nodes_pon_pon, 
                  edges = edges_pon_pon, 
                  directed = TRUE)

# Agregamos medidas de intermediación y centralidad
red_pon_pon <- red_pon_pon %>% 
  activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(),
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"),
         out_degree = centrality_degree(mode = "out"))

red_pon_pon
```

```{r}
red_pon_pon %>% 
    activate(nodes) %>% 
    as_tibble() %>% 
    arrange(desc(intermediacion))
```

**Red 1a Reiteración (Pon-Sec)**

```{r}
# Creamos df con info necesaria:
primera_reit_df <- total_id_nona %>% 
  group_by(id_tesis) %>% 
  slice(1) %>% 
  pivot_longer(cols = c("id_S1_socio","id_S2_socio","id_S3_socio","id_S4_socio","id_S5_socio","id_S6_socio"),
                    values_to = "id_secretario_socio") %>% 
  select(id_tesis,instancia,epoca,materia,id_ponente_socio,id_ponente_socio_rep,id_secretario_socio) %>% 
  drop_na(id_secretario_socio) %>% 
  drop_na(id_ponente_socio_rep) 

primera_reit_df <- primera_reit_df[!duplicated(primera_reit_df), ]

# Agregamos datos sociodemográficos a ponentes
primera_reit_df$genero_pon <- socio[match(primera_reit_df$id_ponente_socio,socio$id_final),"gender"]
primera_reit_df$anio_pon <- socio[match(primera_reit_df$id_ponente_socio,socio$id_final),"year_of_birth"]
primera_reit_df$edo_pon <- socio[match(primera_reit_df$id_ponente_socio,socio$id_final),"state_of_birth"]
primera_reit_df$escuela_pon <- socio[match(primera_reit_df$id_ponente_socio,socio$id_final),"college"]

# Agregamos datos sociodemográficos a secretarios
primera_reit_df$genero_sec <- socio[match(primera_reit_df$id_secretario_socio,socio$id_final),"gender"]
primera_reit_df$anio_sec <- socio[match(primera_reit_df$id_secretario_socio,socio$id_final),"year_of_birth"]
primera_reit_df$edo_sec <- socio[match(primera_reit_df$id_secretario_socio,socio$id_final),"state_of_birth"]
primera_reit_df$escuela_sec <- socio[match(primera_reit_df$id_secretario_socio,socio$id_final),"college"]

# Agregamos columna con generaciones:
primera_reit_df <- primera_reit_df %>%
  mutate(gen_pon = case_when(anio_pon >= 1912 & anio_pon <= 1921 ~ "Depresion",
                             anio_pon >= 1922 & anio_pon <= 1927 ~ "Segunda GM",
                             anio_pon >= 1928 & anio_pon <= 1945 ~ "Post Guerra",
                             anio_pon >= 1946 & anio_pon <= 1954 ~ "Boomers I",
                             anio_pon >= 1955 & anio_pon <= 1965 ~ "Boomers II",
                             anio_pon >= 1966 & anio_pon <= 1976 ~ "Generacion X",
                             TRUE ~ "Previos")) %>% 
  relocate(gen_pon, .before = edo_pon)

primera_reit_df <- primera_reit_df %>%
  mutate(gen_sec = case_when(anio_sec >= 1912 & anio_sec <= 1921 ~ "Depresion",
                             anio_sec >= 1922 & anio_sec <= 1927 ~ "Segunda GM",
                             anio_sec >= 1928 & anio_sec <= 1945 ~ "Post Guerra",
                             anio_sec >= 1946 & anio_sec <= 1954 ~ "Boomers I",
                             anio_sec >= 1955 & anio_sec <= 1965 ~ "Boomers II",
                             anio_sec >= 1966 & anio_sec <= 1976 ~ "Generacion X",
                             TRUE ~ "Previos")) %>% 
  relocate(gen_sec, .before = edo_sec)

# Creamos nodos
nodes_1a_reit <- data.frame(
  data.frame(label=unlist(primera_reit_df[, c("id_ponente_socio_rep","id_secretario_socio")], use.names = FALSE)),
  data.frame(genero=unlist(primera_reit_df[, c("genero_pon","genero_sec")], use.names = FALSE)),
  data.frame(generacion=unlist(primera_reit_df[, c("gen_pon","gen_sec")], use.names = FALSE)),
  data.frame(edo=unlist(primera_reit_df[, c("edo_pon","edo_sec")], use.names = FALSE)),
  data.frame(escuela=unlist(primera_reit_df[, c("escuela_pon","escuela_sec")], use.names = FALSE)))

nodes_1a_reit <- nodes_1a_reit[!duplicated(nodes_1a_reit$label), ]
nodes_1a_reit$id <- nodes_1a_reit %>% group_indices(label) 
nodes_1a_reit <- nodes_1a_reit %>%
  relocate(id, .before = label)

# Creamos aristas
edges_1a_reit <- primera_reit_df[, c("id_ponente_socio_rep","id_secretario_socio","instancia","epoca","materia")]
edges_1a_reit$from <- nodes_1a_reit[match(edges_1a_reit$id_ponente_socio_rep,nodes_1a_reit$label),"id"]
edges_1a_reit$to <- nodes_1a_reit[match(edges_1a_reit$id_secretario_socio,nodes_1a_reit$label),"id"]

#edges_1a_reit <- edges_1a_reit %>% group_by(from,to) %>% 
#  summarise(n_reiter = n()) %>%
#  arrange(-n_reiter)
edges_1a_reit <- edges_1a_reit %>%
  select(from,to,instancia,epoca,materia)

# Creamos red:
red_1a_reit <- tbl_graph(nodes = nodes_1a_reit, 
                  edges = edges_1a_reit, 
                  directed = TRUE)

# Agregamos medidas de intermediación y centralidad
red_1a_reit <- red_1a_reit %>% 
  activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(),
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"),
         out_degree = centrality_degree(mode = "out"))

red_1a_reit
```

**Visualización**

```{r, fig.width=9, fig.height=9}
set.seed(4)

#Visualización inicial para crear layout
red_pon_sec %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec') +
  theme_graph(base_family="sans") #+ facet_nodes(~generacion) 

  #labs(edge_color = "# reiteraciones") +
  #theme(legend.position = c(1, 0), legend.justification = c(1, 0)) + 
  #guides(shape = guide_legend(override.aes = list(size = 2))) + 
  #guides(color = guide_legend(override.aes = list(size = 2))) 
  #theme(legend.title = element_text(size = 6), legend.text = element_text(size = 6))
```

```{r, fig.width=9, fig.height=9}
layout_pon_sec <- create_layout(red_pon_sec, layout = "kk")
#RBJ_2770, -108.21630529
#BBM_3084, -41.21438612

# Mover nodo RBJ_2770 más arriba
layout_pon_sec$y[layout_pon_sec$label == "RBJ_2770"] <- -50

ggraph(layout_pon_sec) +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec') +
  theme_graph(base_family="sans")
```
  
```{r, fig.width=9, fig.height=9}
ggraph(layout_pon_sec) + 
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_edge_loop(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec, conexiones por época') +
  theme_graph(base_family="sans") 

ggraph(layout_pon_sec) +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_edge_loop(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec, conexiones por época') +
  theme_graph(base_family="sans") + facet_edges(~epoca)

ggraph(layout_pon_sec) +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_edge_loop(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec, conexiones por instancia') +
  theme_graph(base_family="sans") + facet_edges(~instancia)
```


```{r, fig.width=9, fig.height=9}
red_pon_sec %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_node_point(aes(size=intermediacion, colour=factor(generacion))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec, nodos por generacion') +
  theme_graph(base_family="sans") + facet_nodes(~generacion) 

red_pon_sec %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec, nodos por estados') +
  theme_graph(base_family="sans")  + facet_nodes(~edo) 

red_pon_sec %>%
  activate(nodes) %>% 
  filter(edo %in% c("Ciudad de Mexico","Chiapas","Estado de Mexico","Jalisco","Michoacan","Veracruz")) %>%
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Sec, nodos por estados específicos') +
  theme_graph(base_family="sans")  + facet_nodes(~edo) 
```

```{r, fig.width=9, fig.height=9}
red_pon_pon %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  #filter(in_degree >= 100) %>%
  #filter(!node_is_isolated()) %>% 
  ggraph(layout = 'kk') + 
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  #geom_edge_link(#aes(width = n_reiter),
  #               colour="gray", arrow = arrow(length = unit(2, "mm"))) + #,start_cap = circle(2, "mm"),end_cap = circle(2, "mm")) +
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon') +
  theme_graph(base_family="sans")
```

```{r, fig.width=9, fig.height=9}
red_pon_pon %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_edge_loop(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon, conexiones por época') +
  theme_graph(base_family="sans") 

red_pon_pon %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_edge_loop(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon, conexiones por época') +
  theme_graph(base_family="sans") + facet_edges(~epoca)

red_pon_pon %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_edge_loop(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon, conexiones por instancia') +
  theme_graph(base_family="sans") + facet_edges(~instancia)
```

```{r, fig.width=9, fig.height=9}
red_pon_pon %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_node_point(aes(size=intermediacion, colour=factor(generacion))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon, nodos por generacion') +
  theme_graph(base_family="sans") + facet_nodes(~generacion) 

red_pon_pon %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon, nodos por estados') +
  theme_graph(base_family="sans")  + facet_nodes(~edo) 

red_pon_pon %>%
  activate(nodes) %>% 
  filter(edo %in% c("Ciudad de Mexico","Chiapas","Estado de Mexico","Jalisco","Michoacan","Veracruz")) %>%
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_edge_loop(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Pon-Pon, nodos por estados específicos') +
  theme_graph(base_family="sans")  + facet_nodes(~edo) 
```

```{r, fig.width=9, fig.height=9}
set.seed(4)

red_1a_reit %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') + 
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec') +
  theme_graph(base_family="sans")
```

```{r, fig.width=9, fig.height=9}
red_1a_reit %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec, conexiones por época') +
  theme_graph(base_family="sans") 

red_1a_reit %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec, conexiones por época') +
  theme_graph(base_family="sans") + facet_edges(~epoca)

red_1a_reit %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec, conexiones por instancia') +
  theme_graph(base_family="sans") + facet_edges(~instancia)
```

```{r, fig.width=9, fig.height=9}
red_1a_reit %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_node_point(aes(size=intermediacion, colour=factor(generacion))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec, nodos por generacion') +
  theme_graph(base_family="sans") + facet_nodes(~generacion) 

red_1a_reit %>%
  activate(nodes) %>% 
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec, nodos por estados') +
  theme_graph(base_family="sans")  + facet_nodes(~edo) 

red_1a_reit %>%
  activate(nodes) %>% 
  filter(edo %in% c("Ciudad de Mexico","Chiapas","Estado de Mexico","Jalisco","Michoacan","Veracruz")) %>%
  #filter(intermediacion >= 10) %>%
  ggraph(layout = 'kk') + #
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('1a reit Pon-Sec, nodos por estados específicos') +
  theme_graph(base_family="sans")  + facet_nodes(~edo) 
```
**Creación de sub-redes**
```{r}
# Pon-Sec

## Por Época
edges_pon_sec_ep6  <- edges_pon_sec %>% filter(epoca == "Sexta Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_ep7  <- edges_pon_sec %>% filter(epoca == "Séptima Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_ep8  <- edges_pon_sec %>% filter(epoca == "Octava Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_ep9  <- edges_pon_sec %>% filter(epoca == "Novena Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_ep10 <- edges_pon_sec %>% filter(epoca == "Décima Época") %>% mutate_at(vars(from,to), as.character)

nodes_pon_sec_ep6 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_ep6[, c("from","to")], use.names=FALSE))  %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_ep6) <- NULL
nodes_pon_sec_ep7 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_ep7[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_ep7) <- NULL
nodes_pon_sec_ep8 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_ep8[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_ep8) <- NULL
nodes_pon_sec_ep9 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_ep9[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_ep9) <- NULL
nodes_pon_sec_ep10 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_ep10[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_ep10) <- NULL

subred_pon_sec_ep6  <- tbl_graph(nodes = nodes_pon_sec_ep6, edges = edges_pon_sec_ep6, directed = TRUE)
subred_pon_sec_ep7  <- tbl_graph(nodes = nodes_pon_sec_ep7, edges = edges_pon_sec_ep7, directed = TRUE)
subred_pon_sec_ep8  <- tbl_graph(nodes = nodes_pon_sec_ep8, edges = edges_pon_sec_ep8, directed = TRUE)
subred_pon_sec_ep9  <- tbl_graph(nodes = nodes_pon_sec_ep9, edges = edges_pon_sec_ep9, directed = TRUE)
subred_pon_sec_ep10 <- tbl_graph(nodes = nodes_pon_sec_ep10, edges = edges_pon_sec_ep10, directed = TRUE)

subred_pon_sec_ep6 <- subred_pon_sec_ep6 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_ep7 <- subred_pon_sec_ep7 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_ep8 <- subred_pon_sec_ep8 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_ep9 <- subred_pon_sec_ep9 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_ep10 <- subred_pon_sec_ep10 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))

## Por Instancia
edges_pon_sec_tribunales <- edges_pon_sec %>% filter(instancia == "Tribunales Colegiados de Circuito") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_pleno <- edges_pon_sec %>% filter(instancia == "Pleno") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_sala1 <- edges_pon_sec %>% filter(instancia == "Primera Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_sala2 <- edges_pon_sec %>% filter(instancia == "Segunda Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_sala3 <- edges_pon_sec %>% filter(instancia == "Tercera Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_sala4 <- edges_pon_sec %>% filter(instancia == "Cuarta Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_salaaux <- edges_pon_sec %>% filter(instancia == "Sala Auxiliar") %>% mutate_at(vars(from,to), as.character)

nodes_pon_sec_tribunales <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_tribunales[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_tribunales) <- NULL
nodes_pon_sec_pleno <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_pleno[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_pleno) <- NULL
nodes_pon_sec_sala1 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_sala1[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_sala1) <- NULL
nodes_pon_sec_sala2 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_sala2[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_sala2) <- NULL
nodes_pon_sec_sala3 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_sala3[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_sala3) <- NULL
nodes_pon_sec_sala4 <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_sala4[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_sala4) <- NULL
nodes_pon_sec_salaaux <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_salaaux[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_salaaux) <- NULL

subred_pon_sec_tribunales  <- tbl_graph(nodes = nodes_pon_sec_tribunales, edges = edges_pon_sec_tribunales, directed = TRUE)
subred_pon_sec_pleno  <- tbl_graph(nodes = nodes_pon_sec_pleno, edges = edges_pon_sec_pleno, directed = TRUE)
subred_pon_sec_sala1  <- tbl_graph(nodes = nodes_pon_sec_sala1, edges = edges_pon_sec_sala1, directed = TRUE)
subred_pon_sec_sala2  <- tbl_graph(nodes = nodes_pon_sec_sala2, edges = edges_pon_sec_sala2, directed = TRUE)
subred_pon_sec_sala3  <- tbl_graph(nodes = nodes_pon_sec_sala3, edges = edges_pon_sec_sala3, directed = TRUE)
subred_pon_sec_sala4  <- tbl_graph(nodes = nodes_pon_sec_sala4, edges = edges_pon_sec_sala4, directed = TRUE)
subred_pon_sec_salaaux  <- tbl_graph(nodes = nodes_pon_sec_salaaux, edges = edges_pon_sec_salaaux, directed = TRUE)

subred_pon_sec_tribunales <- subred_pon_sec_tribunales %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_pleno <- subred_pon_sec_pleno %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_sala1 <- subred_pon_sec_sala1 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_sala2 <- subred_pon_sec_sala2 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_sala3 <- subred_pon_sec_sala3 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_sala4 <- subred_pon_sec_sala4 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_salaaux <- subred_pon_sec_salaaux %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))

## Por Materia (sólo únicas)
edges_pon_sec_admin <- edges_pon_sec %>% filter(materia == "Administrativa") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_civil <- edges_pon_sec %>% filter(materia == "Civil") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_comun <- edges_pon_sec %>% filter(materia == "Común") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_const <- edges_pon_sec %>% filter(materia == "Constitucional") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_laboral <- edges_pon_sec %>% filter(materia == "Laboral") %>% mutate_at(vars(from,to), as.character)
edges_pon_sec_penal <- edges_pon_sec %>% filter(materia == "Penal") %>% mutate_at(vars(from,to), as.character)

nodes_pon_sec_admin <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_admin[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_admin) <- NULL
nodes_pon_sec_civil <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_civil[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_civil) <- NULL
nodes_pon_sec_comun <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_comun[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_comun) <- NULL
nodes_pon_sec_const <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_const[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_const) <- NULL
nodes_pon_sec_laboral <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_laboral[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_laboral) <- NULL
nodes_pon_sec_penal <- subset(nodes_pon_sec, id %in% unlist(edges_pon_sec_penal[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_sec_penal) <- NULL

subred_pon_sec_admin <- tbl_graph(nodes = nodes_pon_sec_admin, edges = edges_pon_sec_admin, directed = TRUE)
subred_pon_sec_civil <- tbl_graph(nodes = nodes_pon_sec_civil, edges = edges_pon_sec_civil, directed = TRUE)
subred_pon_sec_comun <- tbl_graph(nodes = nodes_pon_sec_comun, edges = edges_pon_sec_comun, directed = TRUE)
subred_pon_sec_const <- tbl_graph(nodes = nodes_pon_sec_const, edges = edges_pon_sec_const, directed = TRUE)
subred_pon_sec_laboral <- tbl_graph(nodes = nodes_pon_sec_laboral, edges = edges_pon_sec_laboral, directed = TRUE)
subred_pon_sec_penal <- tbl_graph(nodes = nodes_pon_sec_penal, edges = edges_pon_sec_penal, directed = TRUE)

subred_pon_sec_admin <- subred_pon_sec_admin %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_civil <- subred_pon_sec_civil %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_comun <- subred_pon_sec_comun %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_const <- subred_pon_sec_const %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_laboral <- subred_pon_sec_laboral %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_sec_penal <- subred_pon_sec_penal %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
```

```{r}
# Pon-Pon

## Por Época
edges_pon_pon_ep6  <- edges_pon_pon %>% filter(epoca == "Sexta Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_ep7  <- edges_pon_pon %>% filter(epoca == "Séptima Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_ep8  <- edges_pon_pon %>% filter(epoca == "Octava Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_ep9  <- edges_pon_pon %>% filter(epoca == "Novena Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_ep10 <- edges_pon_pon %>% filter(epoca == "Décima Época") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_ep11 <- edges_pon_pon %>% filter(epoca == "Undécima Época") %>% mutate_at(vars(from,to), as.character)

nodes_pon_pon_ep6 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_ep6[, c("from","to")], use.names=FALSE))  %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_ep6) <- NULL
nodes_pon_pon_ep7 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_ep7[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_ep7) <- NULL
nodes_pon_pon_ep8 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_ep8[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_ep8) <- NULL
nodes_pon_pon_ep9 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_ep9[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_ep9) <- NULL
nodes_pon_pon_ep10 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_ep10[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_ep10) <- NULL
nodes_pon_pon_ep11 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_ep11[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_ep11) <- NULL

subred_pon_pon_ep6  <- tbl_graph(nodes = nodes_pon_pon_ep6, edges = edges_pon_pon_ep6, directed = TRUE)
subred_pon_pon_ep7  <- tbl_graph(nodes = nodes_pon_pon_ep7, edges = edges_pon_pon_ep7, directed = TRUE)
subred_pon_pon_ep8  <- tbl_graph(nodes = nodes_pon_pon_ep8, edges = edges_pon_pon_ep8, directed = TRUE)
subred_pon_pon_ep9  <- tbl_graph(nodes = nodes_pon_pon_ep9, edges = edges_pon_pon_ep9, directed = TRUE)
subred_pon_pon_ep10 <- tbl_graph(nodes = nodes_pon_pon_ep10, edges = edges_pon_pon_ep10, directed = TRUE)
subred_pon_pon_ep11 <- tbl_graph(nodes = nodes_pon_pon_ep11, edges = edges_pon_pon_ep11, directed = TRUE)

subred_pon_pon_ep6 <- subred_pon_pon_ep6 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_ep7 <- subred_pon_pon_ep7 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_ep8 <- subred_pon_pon_ep8 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_ep9 <- subred_pon_pon_ep9 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_ep10 <- subred_pon_pon_ep10 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_ep11 <- subred_pon_pon_ep11 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))

## Por Instancia
edges_pon_pon_tribunales <- edges_pon_pon %>% filter(instancia == "Tribunales Colegiados de Circuito") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_pleno <- edges_pon_pon %>% filter(instancia == "Pleno") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_sala1 <- edges_pon_pon %>% filter(instancia == "Primera Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_sala2 <- edges_pon_pon %>% filter(instancia == "Segunda Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_sala3 <- edges_pon_pon %>% filter(instancia == "Tercera Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_sala4 <- edges_pon_pon %>% filter(instancia == "Cuarta Sala") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_salaaux <- edges_pon_pon %>% filter(instancia == "Sala Auxiliar") %>% mutate_at(vars(from,to), as.character)

nodes_pon_pon_tribunales <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_tribunales[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_tribunales) <- NULL
nodes_pon_pon_pleno <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_pleno[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_pleno) <- NULL
nodes_pon_pon_sala1 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_sala1[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_sala1) <- NULL
nodes_pon_pon_sala2 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_sala2[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_sala2) <- NULL
nodes_pon_pon_sala3 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_sala3[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_sala3) <- NULL
nodes_pon_pon_sala4 <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_sala4[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_sala4) <- NULL
nodes_pon_pon_salaaux <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_salaaux[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_salaaux) <- NULL

subred_pon_pon_tribunales  <- tbl_graph(nodes = nodes_pon_pon_tribunales, edges = edges_pon_pon_tribunales, directed = TRUE)
subred_pon_pon_pleno  <- tbl_graph(nodes = nodes_pon_pon_pleno, edges = edges_pon_pon_pleno, directed = TRUE)
subred_pon_pon_sala1  <- tbl_graph(nodes = nodes_pon_pon_sala1, edges = edges_pon_pon_sala1, directed = TRUE)
subred_pon_pon_sala2  <- tbl_graph(nodes = nodes_pon_pon_sala2, edges = edges_pon_pon_sala2, directed = TRUE)
subred_pon_pon_sala3  <- tbl_graph(nodes = nodes_pon_pon_sala3, edges = edges_pon_pon_sala3, directed = TRUE)
subred_pon_pon_sala4  <- tbl_graph(nodes = nodes_pon_pon_sala4, edges = edges_pon_pon_sala4, directed = TRUE)
subred_pon_pon_salaaux  <- tbl_graph(nodes = nodes_pon_pon_salaaux, edges = edges_pon_pon_salaaux, directed = TRUE)

subred_pon_pon_tribunales <- subred_pon_pon_tribunales %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_pleno <- subred_pon_pon_pleno %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_sala1 <- subred_pon_pon_sala1 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_sala2 <- subred_pon_pon_sala2 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_sala3 <- subred_pon_pon_sala3 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_sala4 <- subred_pon_pon_sala4 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_salaaux <- subred_pon_pon_salaaux %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))

## Por Materia (sólo únicas)
edges_pon_pon_admin <- edges_pon_pon %>% filter(materia == "Administrativa") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_civil <- edges_pon_pon %>% filter(materia == "Civil") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_comun <- edges_pon_pon %>% filter(materia == "Común") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_const <- edges_pon_pon %>% filter(materia == "Constitucional") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_laboral <- edges_pon_pon %>% filter(materia == "Laboral") %>% mutate_at(vars(from,to), as.character)
edges_pon_pon_penal <- edges_pon_pon %>% filter(materia == "Penal") %>% mutate_at(vars(from,to), as.character)

nodes_pon_pon_admin <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_admin[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_admin) <- NULL
nodes_pon_pon_civil <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_civil[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_civil) <- NULL
nodes_pon_pon_comun <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_comun[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_comun) <- NULL
nodes_pon_pon_const <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_const[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_const) <- NULL
nodes_pon_pon_laboral <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_laboral[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_laboral) <- NULL
nodes_pon_pon_penal <- subset(nodes_pon_pon, id %in% unlist(edges_pon_pon_penal[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_pon_pon_penal) <- NULL

subred_pon_pon_admin <- tbl_graph(nodes = nodes_pon_pon_admin, edges = edges_pon_pon_admin, directed = TRUE)
subred_pon_pon_civil <- tbl_graph(nodes = nodes_pon_pon_civil, edges = edges_pon_pon_civil, directed = TRUE)
subred_pon_pon_comun <- tbl_graph(nodes = nodes_pon_pon_comun, edges = edges_pon_pon_comun, directed = TRUE)
subred_pon_pon_const <- tbl_graph(nodes = nodes_pon_pon_const, edges = edges_pon_pon_const, directed = TRUE)
subred_pon_pon_laboral <- tbl_graph(nodes = nodes_pon_pon_laboral, edges = edges_pon_pon_laboral, directed = TRUE)
subred_pon_pon_penal <- tbl_graph(nodes = nodes_pon_pon_penal, edges = edges_pon_pon_penal, directed = TRUE)

subred_pon_pon_admin <- subred_pon_pon_admin %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_civil <- subred_pon_pon_civil %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_comun <- subred_pon_pon_comun %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_const <- subred_pon_pon_const %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_laboral <- subred_pon_pon_laboral %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_pon_pon_penal <- subred_pon_pon_penal %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
```

```{r}
#1a reit (Pon-Sec)

## Por Época
edges_1a_reit_ep6  <- edges_1a_reit %>% filter(epoca == "Sexta Época") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_ep7  <- edges_1a_reit %>% filter(epoca == "Séptima Época") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_ep8  <- edges_1a_reit %>% filter(epoca == "Octava Época") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_ep9  <- edges_1a_reit %>% filter(epoca == "Novena Época") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_ep10 <- edges_1a_reit %>% filter(epoca == "Décima Época") %>% mutate_at(vars(from,to), as.character)

nodes_1a_reit_ep6 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_ep6[, c("from","to")], use.names=FALSE))  %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_ep6) <- NULL
nodes_1a_reit_ep7 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_ep7[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_ep7) <- NULL
nodes_1a_reit_ep8 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_ep8[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_ep8) <- NULL
nodes_1a_reit_ep9 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_ep9[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_ep9) <- NULL
nodes_1a_reit_ep10 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_ep10[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_ep10) <- NULL

subred_1a_reit_ep6  <- tbl_graph(nodes = nodes_1a_reit_ep6, edges = edges_1a_reit_ep6, directed = TRUE)
subred_1a_reit_ep7  <- tbl_graph(nodes = nodes_1a_reit_ep7, edges = edges_1a_reit_ep7, directed = TRUE)
subred_1a_reit_ep8  <- tbl_graph(nodes = nodes_1a_reit_ep8, edges = edges_1a_reit_ep8, directed = TRUE)
subred_1a_reit_ep9  <- tbl_graph(nodes = nodes_1a_reit_ep9, edges = edges_1a_reit_ep9, directed = TRUE)
subred_1a_reit_ep10 <- tbl_graph(nodes = nodes_1a_reit_ep10, edges = edges_1a_reit_ep10, directed = TRUE)

subred_1a_reit_ep6 <- subred_1a_reit_ep6 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_ep7 <- subred_1a_reit_ep7 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_ep8 <- subred_1a_reit_ep8 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_ep9 <- subred_1a_reit_ep9 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_ep10 <- subred_1a_reit_ep10 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))

## Por Instancia
edges_1a_reit_tribunales <- edges_1a_reit %>% filter(instancia == "Tribunales Colegiados de Circuito") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_pleno <- edges_1a_reit %>% filter(instancia == "Pleno") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_sala1 <- edges_1a_reit %>% filter(instancia == "Primera Sala") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_sala2 <- edges_1a_reit %>% filter(instancia == "Segunda Sala") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_sala3 <- edges_1a_reit %>% filter(instancia == "Tercera Sala") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_sala4 <- edges_1a_reit %>% filter(instancia == "Cuarta Sala") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_salaaux <- edges_1a_reit %>% filter(instancia == "Sala Auxiliar") %>% mutate_at(vars(from,to), as.character)

nodes_1a_reit_tribunales <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_tribunales[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_tribunales) <- NULL
nodes_1a_reit_pleno <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_pleno[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_pleno) <- NULL
nodes_1a_reit_sala1 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_sala1[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_sala1) <- NULL
nodes_1a_reit_sala2 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_sala2[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_sala2) <- NULL
nodes_1a_reit_sala3 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_sala3[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_sala3) <- NULL
nodes_1a_reit_sala4 <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_sala4[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_sala4) <- NULL
nodes_1a_reit_salaaux <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_salaaux[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_salaaux) <- NULL

subred_1a_reit_tribunales  <- tbl_graph(nodes = nodes_1a_reit_tribunales, edges = edges_1a_reit_tribunales, directed = TRUE)
subred_1a_reit_pleno  <- tbl_graph(nodes = nodes_1a_reit_pleno, edges = edges_1a_reit_pleno, directed = TRUE)
subred_1a_reit_sala1  <- tbl_graph(nodes = nodes_1a_reit_sala1, edges = edges_1a_reit_sala1, directed = TRUE)
subred_1a_reit_sala2  <- tbl_graph(nodes = nodes_1a_reit_sala2, edges = edges_1a_reit_sala2, directed = TRUE)
subred_1a_reit_sala3  <- tbl_graph(nodes = nodes_1a_reit_sala3, edges = edges_1a_reit_sala3, directed = TRUE)
subred_1a_reit_sala4  <- tbl_graph(nodes = nodes_1a_reit_sala4, edges = edges_1a_reit_sala4, directed = TRUE)
subred_1a_reit_salaaux  <- tbl_graph(nodes = nodes_1a_reit_salaaux, edges = edges_1a_reit_salaaux, directed = TRUE)

subred_1a_reit_tribunales <- subred_1a_reit_tribunales %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_pleno <- subred_1a_reit_pleno %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_sala1 <- subred_1a_reit_sala1 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_sala2 <- subred_1a_reit_sala2 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_sala3 <- subred_1a_reit_sala3 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_sala4 <- subred_1a_reit_sala4 %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_salaaux <- subred_1a_reit_salaaux %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))

## Por Materia (sólo únicas)
edges_1a_reit_admin <- edges_1a_reit %>% filter(materia == "Administrativa") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_civil <- edges_1a_reit %>% filter(materia == "Civil") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_comun <- edges_1a_reit %>% filter(materia == "Común") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_const <- edges_1a_reit %>% filter(materia == "Constitucional") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_laboral <- edges_1a_reit %>% filter(materia == "Laboral") %>% mutate_at(vars(from,to), as.character)
edges_1a_reit_penal <- edges_1a_reit %>% filter(materia == "Penal") %>% mutate_at(vars(from,to), as.character)

nodes_1a_reit_admin <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_admin[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_admin) <- NULL
nodes_1a_reit_civil <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_civil[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_civil) <- NULL
nodes_1a_reit_comun <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_comun[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_comun) <- NULL
nodes_1a_reit_const <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_const[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_const) <- NULL
nodes_1a_reit_laboral <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_laboral[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_laboral) <- NULL
nodes_1a_reit_penal <- subset(nodes_1a_reit, id %in% unlist(edges_1a_reit_penal[, c("from","to")], use.names=FALSE)) %>% mutate(id=as.character(id))
rownames(nodes_1a_reit_penal) <- NULL

subred_1a_reit_admin <- tbl_graph(nodes = nodes_1a_reit_admin, edges = edges_1a_reit_admin, directed = TRUE)
subred_1a_reit_civil <- tbl_graph(nodes = nodes_1a_reit_civil, edges = edges_1a_reit_civil, directed = TRUE)
subred_1a_reit_comun <- tbl_graph(nodes = nodes_1a_reit_comun, edges = edges_1a_reit_comun, directed = TRUE)
subred_1a_reit_const <- tbl_graph(nodes = nodes_1a_reit_const, edges = edges_1a_reit_const, directed = TRUE)
subred_1a_reit_laboral <- tbl_graph(nodes = nodes_1a_reit_laboral, edges = edges_1a_reit_laboral, directed = TRUE)
subred_1a_reit_penal <- tbl_graph(nodes = nodes_1a_reit_penal, edges = edges_1a_reit_penal, directed = TRUE)

subred_1a_reit_admin <- subred_1a_reit_admin %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_civil <- subred_1a_reit_civil %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_comun <- subred_1a_reit_comun %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_const <- subred_1a_reit_const %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_laboral <- subred_1a_reit_laboral %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
subred_1a_reit_penal <- subred_1a_reit_penal %>% activate(nodes) %>% 
  mutate(intermediacion = centrality_betweenness(),
         central_pagerank = centrality_pagerank(), 
         central_eigen = centrality_eigen(),
         in_degree = centrality_degree(mode = "in"), 
         out_degree = centrality_degree(mode = "out"))
```

```{r, fig.width=9, fig.height=7}
subred_pon_sec_ep6 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 6a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_ep7 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 7a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_ep8 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 8a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_ep9 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 9a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_ep10 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 10a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_pon_sec_tribunales %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Tribunales Colegiados de Circuito') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_pleno %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Pleno') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala1 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 1a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala2 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 2a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala3 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 3a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala4 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 4a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_salaaux %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Sala Auxiliar') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_pon_sec_tribunales %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Tribunales Colegiados de Circuito') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_pleno %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Pleno') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala1 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 1a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala2 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 2a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala3 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 3a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_sala4 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, 4a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_salaaux %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Sala Auxiliar') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_pon_pon_tribunales %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, Tribunales Colegiados de Circuito') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_pleno %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, Pleno') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala1 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 1a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala2 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 2a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala3 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 3a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala4 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 4a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_salaaux %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, Sala Auxiliar') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_pon_pon_tribunales %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, Tribunales Colegiados de Circuito') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_pleno %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, Pleno') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala1 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 1a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala2 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 2a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala3 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 3a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_sala4 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, 4a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_pon_salaaux %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Pon, Sala Auxiliar') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_1a_reit_tribunales %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, Tribunales Colegiados de Circuito') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_pleno %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, Pleno') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala1 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 1a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala2 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 2a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala3 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 3a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala4 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 4a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_salaaux %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=epoca), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, Sala Auxiliar') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_1a_reit_tribunales %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, Tribunales Colegiados de Circuito') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_pleno %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, Pleno') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala1 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 1a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala2 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 2a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala3 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 3a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_sala4 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 4a Sala') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_salaaux %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, Sala Auxiliar') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_1a_reit_ep6 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 6a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_ep7 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 7a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_ep8 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 8a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_ep9 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 9a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_1a_reit_ep10 %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red 1a Reit, 10a época') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_pon_sec_admin %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Administrativa') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_civil %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Civil') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_comun %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Común') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_const %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Constitucional') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_laboral %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Laboral') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_penal %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(aes(color=instancia), arrow = arrow(length = unit(2, "mm"))) + #colour="gray"
  geom_node_point(aes(size=intermediacion, colour=central_eigen)) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Penal') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
subred_pon_sec_admin %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) + 
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Administrativa') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_civil %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Civil') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_comun %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Común') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_const %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Constitucional') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_laboral %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Laboral') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)

subred_pon_sec_penal %>%
  activate(nodes) %>% 
  ggraph(layout = 'kk') +
  geom_edge_fan(colour="gray", arrow = arrow(length = unit(2, "mm"))) +
  geom_node_point(aes(size=intermediacion, colour=factor(edo))) + 
  geom_node_text(aes(label=label), repel=T, size=2, nudge_y = 0.1, nudge_x = -0.1) +
  ggtitle('Sub-red Pon-Sec, Penal') +
  theme_graph(base_family="sans") #+ facet_edges(~epoca)
```

```{r, fig.width=9, fig.height=7}
```
